{% extends 'site/_layout/master.html.twig' %}

{% block content %}
    <div class="container-fluid default-form-container" id="scroll-to-container">
        <div class="row border-top-brown">
            <section class="col-12 col-md-4 text-center p-lg-5 m-auto">
                <h3 class="p-3">Zarezerwuj stolik</h3>

                {% if available_hours is not empty %}
                    {{ form_start(form) }}
                    <div class="form-group mt-5">
                        {{ form_label(form.day) }}
                        {{ form_widget(form.day, { attr: { class: 'form-control' } }) }}
                    </div>

                    <div class="form-group mt-5">
                        {{ form_label(form.hour) }}
                        {{ form_widget(form.hour, { attr: { class: 'form-control' } }) }}
                    </div>

                    <div class="form-group mt-5">
                        {{ form_label(form.firstName) }}
                        {{ form_widget(form.firstName, { attr: { class: 'form-control' } }) }}
                    </div>

                    <div class="form-group mt-5">
                        {{ form_label(form.lastName) }}
                        {{ form_widget(form.lastName, { attr: { class: 'form-control' } }) }}
                    </div>

                    <div class="form-group mt-5">
                        {{ form_label(form.phone) }}
                        {{ form_widget(form.phone, { attr: { class: 'form-control' } }) }}
                    </div>

                    <button type="submit" class="btn btn-primary">Zarezerwuj stolik</button>
                    {{ form_end(form) }}
                {% else %}
                    <strong>Brak wolnych miejsc!</strong>
                {% endif %}
            </section>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {% include 'site/_partials/jquery.html.twig' %}

    {% if available_hours is not empty %}
        <script>
            function updateAvailableHoursSelect() {
                const $dayField = $('[name="{{ form.day.vars.full_name }}"]');
                const $hourField = $('[name="{{ form.hour.vars.full_name }}"]');

                const selectedDay = $dayField.val();
                const availableHours = $hourField.data('availableHours')[selectedDay];

                $hourField.find('option').remove().end();

                for (let i = 0; i < availableHours.length; i++) {
                    $hourField.append(`<option value="${availableHours[i]}">${availableHours[i]}:00</option>`)
                }
            }

            $(document).ready(function () {
                updateAvailableHoursSelect();

                const $dayField = $('[name="{{ form.day.vars.full_name }}"]');

                $dayField.on('change', function () {
                    updateAvailableHoursSelect();
                })
            });
        </script>
    {% endif %}
{% endblock %}
